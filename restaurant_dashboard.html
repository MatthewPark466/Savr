<!-- restaurant-dashboard.html -->
<body>
  <h1>Restaurant Dashboard</h1>
  <div id="menuContainer" class="placeholder">No items listed yet</div>
  <button id="addListingBtn">Add New Listing</button>
  <button id="logoutBtn">Logout</button>

  <script type="module">
    import { auth, db, onAuthChange, getDoc, setDoc, doc, collection, getDocs, serverTimestamp, logout } from './firebase.js';

    onAuthChange(async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const snap = await getDoc(doc(db, "users", user.uid));
      if (!snap.exists() || snap.data().role !== "restaurant") {
        alert("Not authorized");
        window.location.href = "customer-dashboard.html";
        return;
      }

      loadMenu(user.uid);
    });

    async function loadMenu(restaurantId) {
      const menuRef = collection(db, "restaurants", restaurantId, "menu");
      const snapshot = await getDocs(menuRef);
      const container = document.getElementById("menuContainer");

      if (snapshot.empty) {
        container.innerHTML = "No items listed yet";
        return;
      }

      container.innerHTML = snapshot.docs.map(doc => {
        const item = doc.data();
        return `<div><strong>${item.name}</strong> â€” $${item.price} (${item.quantity} left)</div>`;
      }).join('');
    }

    document.getElementById("addListingBtn").addEventListener("click", async () => {
      const name = prompt("Item name?");
      const price = parseFloat(prompt("Price?"));
      const quantity = parseInt(prompt("Quantity?"));

      if (!name || isNaN(price) || isNaN(quantity)) return alert("Invalid input");

      const itemId = Date.now().toString();
      await setDoc(doc(db, "restaurants", auth.currentUser.uid, "menu", itemId), {
        name, price, quantity, createdAt: serverTimestamp()
      });

      loadMenu(auth.currentUser.uid);
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await logout();
      window.location.href = "login.html";
    });
  </script>
</body>
